<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>你不知道的按位运算 | Just For Fun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="先来看LeetCode上的Divide Two Integers题目要求：

Divide two integers without using multiplication, division and mod operator.

就是说不用乘法，除法，求模运算来实现两个整数相除，看起来很简单，我可以用除数减去被除数，直到除数小于被除数，记录减法操作的次数即可。假设是计算m/n，那么时间复杂度为">
<meta property="og:type" content="article">
<meta property="og:title" content="你不知道的按位运算">
<meta property="og:url" content="http://selfboot.cn/2015/09/23/something_about_bit_operation/index.html">
<meta property="og:site_name" content="Just For Fun">
<meta property="og:description" content="先来看LeetCode上的Divide Two Integers题目要求：

Divide two integers without using multiplication, division and mod operator.

就是说不用乘法，除法，求模运算来实现两个整数相除，看起来很简单，我可以用除数减去被除数，直到除数小于被除数，记录减法操作的次数即可。假设是计算m/n，那么时间复杂度为">
<meta property="og:image" content="http://xuelangzf-github.qiniudn.com/20150923_bit_operator.png">
<meta property="og:image" content="http://xuelangzf-github.qiniudn.com/20150923_two's_complement.png">
<meta property="og:updated_time" content="2015-11-27T11:35:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你不知道的按位运算">
<meta name="twitter:description" content="先来看LeetCode上的Divide Two Integers题目要求：

Divide two integers without using multiplication, division and mod operator.

就是说不用乘法，除法，求模运算来实现两个整数相除，看起来很简单，我可以用除数减去被除数，直到除数小于被除数，记录减法操作的次数即可。假设是计算m/n，那么时间复杂度为">
<meta name="twitter:image" content="http://xuelangzf-github.qiniudn.com/20150923_bit_operator.png">
  
    <link rel="alternative" href="/atom.xml" title="Just For Fun" type="application/atom+xml">
  
  
    <link rel="icon" href="/image/favicon.ico">
  
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link href="//libs.useso.com/js/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41784041-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
<!-- Baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?fd3ab4b3c488cbb43afa1c2669f06648";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- End Baidu Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Just For Fun</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">享受快乐的时光</a>
        </h2>
      
    </div>
    <div id="header-menu">
      <nav id="main-nav">
        <ul>
        
          <li><a href="/"><i class="fa fa-home icon-setting"></i></a></li>
        
          <li><a href="/archives"><i class="fa fa-archive icon-setting"></i></a></li>
        
          <li><a href="/aboutme.html"><i class="fa fa-user icon-setting"></i></a></li>
        
        
          <li><a href="/atom.xml"><i class="fa fa-rss %> icon-setting"></i></a></li>
        
        </ul>
      </nav>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-something_about_bit_operation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/23/something_about_bit_operation/" class="article-date">
  <time datetime="2015-09-22T16:00:00.000Z" itemprop="datePublished">9月 23 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/计算机基础/">计算机基础</a>
  </div>

  </div>
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      你不知道的按位运算
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>先来看<a href="https://leetcode.com" target="_blank" rel="external">LeetCode</a>上的<a href="https://leetcode.com/problems/divide-two-integers/" target="_blank" rel="external">Divide Two Integers</a>题目要求：</p>
<blockquote>
<p>Divide two integers without using multiplication, division and mod operator.</p>
</blockquote>
<p>就是说不用<code>乘法，除法，求模运算</code>来实现两个整数相除，看起来很简单，我可以用除数减去被除数，直到除数小于被除数，记录减法操作的次数即可。假设是计算m/n，那么时间复杂度为O(m/n)。用Python实现后，<code>Time Limit Exceeded</code>。我们考虑有没有更加优化的算法呢？</p>
<p>如果很难想得到，那就先来回忆下二进制数按位运算的一些知识。</p>
<a id="more"></a>
<h1 id="二进制数按位运算"><a href="#二进制数按位运算" class="headerlink" title="二进制数按位运算"></a>二进制数按位运算</h1><p>计算机里面所有数据都存储为0，1串，所有的运算归根到底都转为二进制数的运算。相信大家都知道二进制数按位运算的规则：</p>
<p><img src="http://xuelangzf-github.qiniudn.com/20150923_bit_operator.png" alt="二进制位运算规则"></p>
<p>来看一些简单的例子：</p>
<pre><code>1010 &amp; 1100 = 1000
1010 | 1100 = 1110
1010 ^ 1100 = 0110
1010 &lt;&lt; 2   = 101000
1010 &gt;&gt; 2   = 10
~1010       = 0101
</code></pre><p>单纯的二进制位之间的这些运算相当简单，但对我们实际编程并没有直接帮助，因为编程过程中需要的经常是数字间的运算，比如 5*(2^4) 。真的是这样吗？接着往下看！</p>
<h1 id="计算机中数字的存储方式"><a href="#计算机中数字的存储方式" class="headerlink" title="计算机中数字的存储方式"></a>计算机中数字的存储方式</h1><p>我们都知道计算机中万物皆为0、1，将万物变为0、1的过程叫做编码，这里我们只讨论将数字编码为0、1的过程。</p>
<p>计算机中对数字的表示有三种方式：原码，反码，补码：</p>
<ul>
<li>原码表示法在数值前面增加了一位符号位（即最高位为符号位）：正数该位为0，负数该位为1。比如十进制3如果用8个二进制位来表示就是 00000011， -3就是 10000011。</li>
<li>反码表示方法：正数的反码是其本身；负数的反码是在其原码的基础上，符号位不变，其余各个位取反。</li>
<li>补码表示方法：正数的补码是其本身；负数的补码是在其原码的基础上，符号位不变，其余各位取反，最后+1。 (即在反码的基础上+1)</li>
</ul>
<p>原码容易被人脑直接识别并用于计算，但是对于计算机来说并不友好。所以在计算机系统中，数值一律用补码来表示、运算和存储。使用补码，可以将符号位和数值域统一处理，将加法和减法统一处理。此外，补码与原码相互转换，其运算过程是相同的，不需要额外的硬件电路。详细的解释可以参考<a href="http://www.cnblogs.com/zhangziqiu/archive/2011/03/30/computercode.html" target="_blank" rel="external">原码, 反码, 补码详解</a>。</p>
<h1 id="数字的按位运算"><a href="#数字的按位运算" class="headerlink" title="数字的按位运算"></a>数字的按位运算</h1><p>计算机中数字存储为补码形式，各个数之间的运算也是对它们的补码做运算，而且得到的结果也是补码，如下图：</p>
<p><img src="http://xuelangzf-github.qiniudn.com/20150923_two&#39;s_complement.png" alt="补码运算"></p>
<p>各种编程语言都提供了对补码的二进制位直接进行运算的方法。以Python为例：</p>
<pre><code>&gt;&gt;&gt; 0b1010 &amp; 0b1100
8   #1000
&gt;&gt;&gt; 0b1010 | 0b1100
14  #1110
&gt;&gt;&gt; 0b1010 ^ 0b1100
6   #0110
&gt;&gt;&gt; 0b1010 &lt;&lt; 2
40  #101000
&gt;&gt;&gt; 0b1010 &gt;&gt; 2
2   #10
&gt;&gt;&gt; ~0b1010
-11 #10000000 00000000 00000000 00001011
&gt;&gt;&gt; type(0b1010)
&lt;type &apos;int&apos;&gt;
</code></pre><p>上面0b开头的0、1串表示整型数字，在32位操作系统中，Python中int类型一般占32个二进制位，以最后一个求反运算为例子，1010的补码为</p>
<blockquote>
<p>00000000 00000000 00000000 00001010</p>
</blockquote>
<p>求反操作后为：</p>
<blockquote>
<p>11111111 11111111 11111111 11110101</p>
</blockquote>
<p>即为-11(原码为：<code>10000000 00000000 00000000 00001011</code>)的补码。（对一个数的补码求补码即可得到该数的原码）</p>
<h1 id="另辟蹊径的按位运算"><a href="#另辟蹊径的按位运算" class="headerlink" title="另辟蹊径的按位运算"></a>另辟蹊径的按位运算</h1><p>那么按位运算在实际编程中可以扮演哪些角色呢？简单点地，可以用来判断奇、偶数：<code>num &amp; 0x1</code>，或者对一个数变换符号：<code>~num + 1</code>；复杂点的可以用来交换两个数，求绝对值等等。</p>
<ol>
<li><p>不用额外的变量实现两个数字互换。</p>
<pre><code>def swap(num_1, num_2):
    num_1 ^= num_2
    num_2 ^= num_1
    num_1 ^= num_2
    return num_1, num_2
</code></pre><p> 证明很简单，我们只需要明白异或运算满足下面规律：</p>
<ul>
<li>0^a = a; </li>
<li>a^a = 0;</li>
<li><p>a^b^c = a^c^b;</p>
<p>巧妙运用异或可以高效解决很多问题，比如 <strong>找出数组中只出现了一次的数（除了一个数只出现一次外，其他数都是出现两次）</strong>，以及它的升级版：<a href="http://blog.csdn.net/morewindows/article/details/8214003" target="_blank" rel="external">数组中只出现1次的两个数字(百度面试题)</a>。</p>
</li>
</ul>
</li>
<li><p>不用判断语句来实现求绝对值。</p>
<pre><code>def bit_abs(num):
    negative = num &gt;&gt; 31
    return (num ^ negative) - negative
</code></pre><p> 这里假设程序运行环境中操作系统为32位，int型整数(不考虑整数溢出)用32位存储，因此可以用 <code>num&gt;&gt;31</code> 取出符号位，后面的部分留给大伙证明。</p>
</li>
<li><p><a href="https://leetcode.com/problems/subsets/" target="_blank" rel="external">生成一个集合的所有子集合</a>。</p>
<p> 比如说我们有一个集合{2,3,4}，那么它的子集合即为{}, {2}, {3}, {4}, {2,3}, {2,4}, {3,4}, {2,3,4}，一共有2 ** 3 = 8个。如何用程序生成所有的子集合呢？用位操作来做的话就相当简单，只需要将0到7中的每个数字转为二进制，如果第i位为0，则表示子集中不包含有原集中第i位；如果为1，则包含第i位。LeetCode上面有<a href="https://leetcode.com/tag/bit-manipulation/" target="_blank" rel="external">许多题目</a>都可以用位操作的思想去解决。</p>
<pre><code>subsets = []
n = len(nums)
sum_sets = 2 ** n
for i in range(sum_sets):
    cur_set = []
    for j in range(n):
        power = 2 ** j
        if i &amp; power == power:
            cur_set.append(nums[j])

    subsets.append(cur_set)

return subsets
</code></pre></li>
</ol>
<h1 id="Leetcode-题目思路"><a href="#Leetcode-题目思路" class="headerlink" title="Leetcode 题目思路"></a>Leetcode 题目思路</h1><p>回到文章开始提到的题目中，我们对除数减去被除数的过程稍作改进。假设求m/n，我们不一次次的 m-n，而是找到n的一个倍数，使得m-x*n尽可能小，这样能减少循环减法的次数，进而提高效率。我们知道在按位操作中，n << k相当于 n * 2^k，因此可以用2^k 来找合适的x。</p>
<p>我们需要这样的一个数字k，它使得n * 2^k < m < n* 2^(k+1)， 然后用m - n*2^k，得到新的m'。再找相应的k'，做减法，如此循环即可。代码放在<a href="https://gist.github.com/xuelangZF/32b1ccc98b8dd4ce67e9#file-leetcode_29-py" target="_blank" rel="external">这里</a>。</p>
<p><strong>相关阅读</strong><br><a href="https://wiki.python.org/moin/BitwiseOperators" target="_blank" rel="external">Pyhon wiki: BitwiseOperators</a><br><a href="http://blog.csdn.net/morewindows/article/details/7354571" target="_blank" rel="external">位操作基础篇之位操作全面总结</a>  </p>

      
    </div>

    
	    <!-- 添加捐赠图标 -->
<div class ="post-donate">
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
		   欣赏此文？支持一下吧
        </span>
        <br>
      </div>  
	<div id="donate_guide" class="donate_bar center hidden" >
		<!-- 支付宝打赏图案 -->
		<img src="http://xuelangzf-github.qiniudn.com/zhifubao.jpg" alt="支付宝打赏"> 
		<!-- 微信打赏图案 -->
		<img src="http://xuelangzf-github.qiniudn.com/weixin.jpg" alt="微信打赏">  
    </div>
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function(){
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}
	</script>
</div>
<!-- 添加捐赠图标 -->

    
  
    
	    <div class="article-footer-copyright">

<p>本文由 selfboot 发表于 <a href="http://selfboot.cn" target="_blank">个人博客</a>，采用<a href="http://creativecommons.org/licenses/by-sa/3.0/cn" target="_blank" >署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>。</p>
<p>非商业转载请注明作者及出处。商业转载请联系<a href="mailto:xuezaigds@gmail.com">作者</a>本人。</p>
<p>
本文标题为: 你不知道的按位运算<br/>
本文链接为: <a href="/2015/09/23/something_about_bit_operation/" target="_blank">http://selfboot.cn/2015/09/23/something_about_bit_operation/</a>
</p>
</div>

    

    <footer class="article-footer">
      
        <a href="http://selfboot.cn/2015/09/23/something_about_bit_operation/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/总结/">总结</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/10/13/pages_count/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          讲的明白，但写的明白吗？
        
      </div>
    </a>
  
  
    <a href="/2015/01/11/django_start(2)/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">两篇文章帮你入门Django(下)</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



  <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57adc438b914651b"></script>



</section>
      </div>
    </div>
    
    
<script>
  var disqus_shortname = 'xuelangZF';
  
  var disqus_url = 'http://selfboot.cn/2015/09/23/something_about_bit_operation/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script src="http://libs.useso.com/js/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/script.js"></script>

  </div>
</body>
</html>
